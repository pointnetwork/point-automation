version: 2.1

orbs:
  node: circleci/node@5.0.2
  browser-tools: circleci/browser-tools@1.3.0

jobs:
  tests_linux:
    docker:
      - image: 'cimg/node:current-browsers'
    steps:
      - checkout
      - browser-tools/install-chrome
      - browser-tools/install-chromedriver
      - setup_remote_docker:
          version: 20.10.14
      - run:
          command: |
            google-chrome --version
            chromedriver --version
          name: Check install
      - node/install:
          node-version: '16.7.0'
      - run:
          name: Install dependencies
          command: npm install
      - run:
          name: Download Point
          command: wget https://github.com/pointnetwork/pointnetwork-dashboard/releases/download/v0.2.73/point-v0.2.73-Linux-Debian-Ubuntu.tar.gz
      - run:
          name: Unzip Point
          command: gunzip -c point-v0.2.73-Linux-Debian-Ubuntu.tar.gz | tar xopf -
      - run:
          name: Install Dependencies Point
          command: sudo apt-get install libnotify4
      - run:
          name: Install Point
          command: sudo dpkg -i point.deb && sudo apt-get install -f
      - run:
          name: Decrypt credentials
          command : npm run decrypt-credentials
      - run:
          name: Test
          command: npm run simple-test-linux
      - store_artifacts:
          path: tests/reports/html-reports
      - store_artifacts:
          path: ~/.point/pointdashboard.log
      - store_artifacts:
          path: ~/.point/point.log


workflows:
  version: 2.1
  smoke_tests:
    jobs:
      - tests_linux




